# 25-1 졸업프로젝트 그로쓰 18팀 - 코드의정상화

<!-- Template for PROJECT REPORT of CapstoneDesign 2025-2H, initially written by khyoo -->
<!-- 본 파일은 2025년도 컴공 졸업프로젝트의 <1차보고서> 작성을 위한 기본 양식입니다. -->
<!-- 아래에 "*"..."*" 표시는 italic체로 출력하기 위해서 사용한 것입니다. -->
<!-- "내용"에 해당하는 부분을 지우고, 여러분 과제의 내용을 작성해 주세요. -->

# Team-Info
| (1) 과제명 | *Graphhopper와 Multi-Factor Route Optimization Algorithm을 이용한 러너 맞춤형 경로 추천 서비스*
|:---  |---  |
| (2) 팀 번호 / 팀 이름 | *18-코드의 정상화* |
| (3) 팀 구성원 | 좌연주 (2271059): 리더, *BE, FE, AI* <br> 최서연 (2076410): 팀원, *BE, FE, AI* <br> 성은재 (2176181) : 팀원, *BE, FE, AI*			 |
| (4) 팀 지도교수 | 심재형 교수님 |
| (5) 과제 분류 | *산학과제* |
| (6) 과제 키워드 | *경로추천, 피드백, GraphHopper*  |
| (7) 과제 내용 요약 | *RunPT의 기능은 크게 네 가지가 있다. <br> 첫 번째로 RunPT는 사용자가 입력한 정보를 반영하여 러닝 경로를 생성한다. 이를 위해서 사용자에게 거리, 경사, 출발지, 목적지를 입력받으며 입력된 정보를 바탕으로 조건을 만족하는 경로를 탐색한다. 이때 다른 지도 서비스와는 다르게 RunPT의 경우 출발지와 목적지가 같은 위치이더라도 경로를 탐색할 수 있다. <br> 두 번째로 RunPT는 러닝 기록(경로, 시간, 거리, 페이스)을 생성한다. 사용자는 기록 페이지에서 자신의 지난 기록을 조회할 수 있으며 이를 바탕으로 기록과 동일한 경로로 러닝할 수도 있다. <br> 세 번째로 RunPT는 피드백 기능을 제공한다. 사용자는 러닝 후 피드백을 작성할 수 있으며 이를 바탕으로 RunPT는 경로의 가중치와 추천 경로를 수정하여 사용자에게 맞춤형 경로를 제공한다.<br> 마지막으로 RunPT는 뱃지라는 명예 보상 시스템을 제공하여 사용자가 탐색한 경로를 완주할 때에 뱃지를 얻을 수 있다. 이로 하여금 사용자는 러닝에 대한 동기를 부여받을 수 있게 된다.* |

<br>

# Project-Summary
| 항목 | 내용 |
|:---  |---  |
| (1) 문제 정의 | *러닝을 즐기는 사람들은 다양한 경로를 달리거나 원하는 거리와 경사도가 반영된 경로를 달리고 싶어하지만 기존 경로 추천 서비스에서는 단순히 최단 경로만 제공하거나 기존 러닝 앱에서는 단순히 기록 기능만 제공한다. <br> 이 서비스의 Target Customer는 주 3-4회, 5km이상 러닝하는 서울 도심에 거주중인 러너이다. 이 Customer들은 도심에서 다양한 경로를 탐색하고 새로운 장소를 달리는 것에서 즐거움을 느낀다. <br> 하지만 기존의 러닝 앱은 단순히 러닝을 기록하는 서비스 제공에 그치지 않는다. 또한 특정 경사도나 거리를 반영한 경로로 달리기를 원할 때는 직접 경로를 찾아봐야 하는 불편함이 있다.*  |
| (2) 기존연구와의 비교 | *기존에 존재하는 서비스로는 경로 탐색(거의 최단경로) 및 제공을 해주는 지도 앱과 러닝 기록을 기록해주는 기능이 대부분인 서비스로 나뉘어져 있다. <br> 지도 앱의 경우 출발지와 도착지를 입력하면 최단경로로 경로를 탐색해서 안내하며, 러닝 앱은 사용자가 러닝 시작버튼을 누르면 러닝 경로, 시간, 페이스를 기록해준다. 지도 앱의 경우 최단 경로는 잘 안내해주지만 프로젝트에서 해결하고자 하는 문제인 희망 거리만큼의 경로를 제공해주지 못하며, 러닝 앱은 경로를 상세히 기록했지만 경로를 추천해주는 기능은 없어서 사용자가 직접 경로를 찾아봐야한다. <br> RunPT는 위 두 기능을 좀 더 발전시켜서 합친 것으로, 사용자의 취향(경사도, 거리)를 반영한 경로를 탐색해주며 러닝을 기록할 뿐만 아니라 피드백을 통해서 다음 러닝에 더 나은 경험을 제공해줄 수 있다.* |
| (3) 제안 내용 | *원하는 거리 및 경사도를 반영한 러닝 경로 생성 <br> 러닝 기록(경로, 시간, 거리, 페이스) 저장 <br> 피드백 기능을 통해 불만족스러웠던 경로는 다음 러닝에서 배제 <br> 뱃지와 같은 명예 보상 시슴템을 통해 동기부여* |
| (4) 기대효과 및 의의 | *사용자는 RunPT를 이용해 크게 3가지의 기대 효과를 얻을 수 있다. <br> 첫 번째로, 사용자는 단순한 최단경로가 아닌 원하는 거리, 경사도를 반영한 러닝 경로를 제공받을 수 있다. <br> 두 번째로, RunPT는 매번 조금씩 다른 경로를 제공하기 때문에 사용자는 색다른 러닝 경험을 제공받을 수 있다. <br> 세 번째로, 피드백 기능을 통해 추천 경로가 점차 수정되기 때문에, 시간이 지날수록 사용자는 자신에게 맞춤화된 경로를 제공받을 수 있다.<br> 이때 RunPT는 기존의 서비스들과 다르게 단순히 최단경로를 생성하는 것이 아니라 사용자의 니즈를 반영하여 경로를 생성할 수 있으며, 출발지와 도착지가 같은 경우에도 러닝경로를 생성할 수 있고 피드백 기능을 통해 경로를 개선할 수 있다는 점에서 의의가 있다.* |
| (5) 주요 기능 리스트 | *사용자에게 거리, 경사 출발지, 목적지를 입력받음 <br> 입력된 정보를 바탕으로 저건을 만족하는 경로를 탐색함 <br> 출발지와 목적지가 같은 위치이더라도 경로를 탐색할 수 있음 <br> 기록 페이지에서 자신의 지난 기록을 조회할 수 있음 <br> 지난 기록을 바탕으로 그 기록과 동일한 경로로 러닝할 수 있음 <br> 사용자에게 피드백을 제공받은 경로의 가중치를 수정함 <br>  경로의 가중치에 따라 사용자에게 추천하는 경로가 수정됨 <br> 탐색된 경로를 완주하면 뱃지를 부여받음* |

<br>
 
# Project-Design & Implementation
| 항목 | 내용 |
|:---  |---  |
| (1) 요구사항 정의 | **🔹 사용자 요구사항 (User Requirements)**<br>1. 사용자는 원하는 러닝 **거리(km)**를 입력할 수 있어야 한다.<br>2. 사용자는 경로의 **경사도 선호도(예: 평탄/언덕 있음)**를 선택할 수 있어야 한다.<br>3. 사용자는 **출발지와 목적지 좌표**를 선택할 수 있어야 하며, 동일 위치여도 경로 탐색이 가능해야 한다.<br>4. 러닝 후 사용자는 **피드백(좋았던 점/불편한 점)**을 입력할 수 있어야 한다.<br>5. 사용자는 **기록된 경로, 거리, 시간, 페이스** 등의 러닝 히스토리를 조회할 수 있어야 한다.<br>6. 특정 경로를 **반복해서 러닝하거나 공유**할 수 있어야 한다.<br>7. 일정 조건(예: 거리 달성, 특정 경로 완주 등) 달성 시 **뱃지를 획득**할 수 있어야 한다.<br><br>**🔹 시스템 요구사항 (System Requirements)**<br>- **경로 추천 알고리즘**은 GraphHopper 기반으로 동작하며, 사용자 요구(거리, 경사도)에 맞는 경로를 생성해야 함<br>- **Feedback 처리 엔진**은 사용자의 피드백을 반영하여 경로 가중치를 조정하고, 추천 결과를 점진적으로 개선해야 함<br>- **DB**에는 사용자 정보, 경로 데이터, 피드백, 러닝 기록, 뱃지 획득 현황 등이 저장되어야 함<br>- 시스템은 **웹 기반 UI**를 통해 사용자에게 직관적인 인터페이스를 제공해야 하며, 경로 지도는 Leaflet 또는 유사한 지도 라이브러리 기반으로 시각화<br><br>**🔹 기능 유스케이스 (Use Case 예시)**<br> - UC-01: 사용자 등록/로그인 → 계정을 생성하고 로그인하여 개인화된 기능 사용 가능<br> - UC-02: 경로 탐색 → 거리, 경사도, 출발지/목적지에 따른 경로 탐색<br> - UC-03: 러닝 기록 저장 → 경로, 시간, 거리, 페이스 등의 러닝 정보 저장<br> - UC-04: 피드백 입력 → 러닝 종료 후 피드백 입력 가능<br> - UC-05: 경로 가중치 업데이트 → 피드백을 바탕으로 경로 추천 알고리즘 가중치 조정<br> - UC-06: 뱃지 획득 → 조건 충족 시 뱃지 부여 |
| (2) 전체 시스템 구성 | **🔹 전체 시스템 구조**<br>아래는 RunPT 시스템의 전체 흐름 구조이며, 사용자와 각 소프트웨어 모듈의 관계를 포함한다:<br><br>[사용자]<br> &nbsp;&nbsp;↓<br>[프론트엔드 (Android 앱, Kotlin)]<br> &nbsp;&nbsp;↓<br> [Firebase SDK로 직접 통신]<br> &nbsp;&nbsp;↙&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;↘<br> [Firestore / Realtime DB]  [Storage / Authentication / Cloud Functions] <br><br> **🔹 소프트웨어 모듈 및 역할**<br>- **사용자 (러너)**: 원하는 거리/경사/출발지/목적지를 입력하고, 경로를 따라 러닝하며 피드백을 제공함<br>- **Android 프론트엔드 (Kotlin)**: UI 화면을 통해 사용자 입력을 받고 지도 상에 경로를 표시함. Firebase와 직접 연결되어 데이터 송수신<br>- **Firebase Firestore / Realtime DB**: 사용자 설정, 경로 데이터, 피드백, 뱃지 정보를 저장하고 관리<br>- **Firebase Authentication**: 이메일/소셜 로그인 기능을 제공하여 사용자 계정 생성 및 인증<br>- **Firebase Storage**: GeoJSON 경로 파일이나 이미지 파일 등을 저장<br>- **GraphHopper 서버** (외부 연동): 거리, 경사도 등을 기반으로 최적의 러닝 경로를 생성하는 오픈소스 경로 엔진<br><br>**🔹 사용 외부 오픈소스 및 라이브러리**<br>- **GraphHopper**: Java 기반의 고성능 경로 탐색 엔진. OpenStreetMap 데이터를 기반으로 다양한 조건의 경로 생성 가능<br>- **OpenStreetMap (OSM)**: 러닝 경로 생성을 위한 지도 데이터로 사용<br>- **MapLibre SDK (Android)**: 오픈소스 지도 렌더링 라이브러리로, GeoJSON 데이터를 Android 지도에 시각화하여 러닝 경로를 표시함<br><br>**🔹 사용자 흐름 요약**<br>1. 사용자가 Android 앱에서 러닝 조건(거리/경사 등)을 입력<br>2. 앱이 Firebase를 통해 조건 저장 후, GraphHopper API 호출<br>3. 반환된 경로(GeoJSON)를 MapLibre 지도 위에 시각화하여 사용자에게 보여줌<br>4. 러닝 종료 후, 피드백과 러닝 데이터를 Firebase에 저장<br>5. Firebase Functions 혹은 서버를 통해 경로 추천 로직이 점진적으로 개선됨 |
| (3) 주요엔진 및 기능 설계 | **🔹 주요 기능 모듈 설계**<br>1. **경로 생성 모듈 (GraphHopper 기반 커스텀 알고리즘)**<br>- GraphHopper의 기존 거리 기반 탐색 기능을 기반으로, 팀 자체 알고리즘을 도입하여 커스터마이징된 경로를 생성함<br>- 사용자가 입력한 조건(출발지, 도착지, 거리, 경사도, 피드백 기반 제외 구간 등)에 따라 출발지=도착지인 루프 경로와 출발지≠도착지인 일방 경로를 각각 생성하는 로직을 구현<br>- 경로는 OpenStreetMap 데이터를 기반으로 생성되며, GeoJSON 형식으로 반환됨<br>-osm 보행자 도로 데이터와 국토지리정보원의 DEM고도 데이터를 통해서 QGIS 소프트웨어를 활용해서 gpkg형식의 경사도 데이터를 만들어냄<br>- 생성된 GeoJSON은 Firebase Storage에 저장되어 Android 앱에서 활용됨<br>2. **지도 시각화 모듈 (MapLibre SDK)**<br>- GeoJSON 형식의 경로 데이터를 Android 앱 내 MapLibre를 통해 지도 위에 렌더링<br>- 사용자는 경로를 확인하고 실시간으로 러닝을 수행할 수 있음<br>- 향후 각 경로 구간에 대한 피드백 기능이 지도 위에서 직접 연결되는 형태로 확장될 예정<br>3. **피드백 기반 경로 조정 모듈 (Spark Java 연동)**<br>- 러닝 종료 후, 사용자는 전체 경로나 특정 구간에 대해 만족도 기반 피드백을 입력 가능<br>- 입력된 피드백은 **먼저 Spark Java 서버로 전달되며**, 서버는 이를 전처리하거나 필요한 인증 및 포맷 작업 후 **Firebase Firestore로 전달**<br>- Firestore에 저장된 피드백 데이터는 Cloud Functions 또는 백엔드 서버에서 주기적으로 집계 및 분석됨<br>- 누적된 부정적 피드백이 일정 수준 이상인 구간은 이후 경로 탐색 시 가중치가 낮아져, 해당 구간이 경로에서 제외될 가능성이 높아짐<br>4. **Firebase 기반 데이터 처리 모듈**<br>- 사용자 정보, 러닝 기록, 피드백, 뱃지 정보 등은 Firestore 또는 Realtime DB를 통해 저장 및 관리<br>- Firebase Authentication을 통해 사용자 인증 및 회원 관리 수행<br>- 경로 데이터는 Firebase Storage에 GeoJSON 형식으로 저장되어 효율적으로 관리됨<br>5. **러닝 기록 및 보상 시스템**<br>- 사용자의 러닝 기록(거리, 시간, 페이스, 경로 ID 등)을 Firestore에 기록함<br>- 특정 조건 충족 시(예: 거리 달성, 특정 경로 첫 완주 등) 뱃지를 자동 발급<br>- 뱃지는 앱 내 마이페이지에서 시각적으로 표시되어 사용자 동기부여에 기여함<br>**🔹 모듈 간 연동 구조**<br>1. 사용자 입력 (거리, 경사도, 출발/도착 위치, 피드백 정보) → Android 앱<br>2. 앱은 Firebase를 통해 조건 저장 후, 커스텀 routing 알고리즘 서버 호출<br>3. Routing 서버는 조건에 따라 루프형 또는 일방형 경로 생성 → GeoJSON 반환 및 Firebase Storage 저장<br>4. 앱은 Storage에서 GeoJSON을 불러와 MapLibre를 통해 지도 위에 시각화<br>5. 러닝 완료 후 피드백 입력 → Spark Java 서버 경유 → Firestore 저장 → 이후 경로 가중치에 반영되어 경로 개선<br>**🔹 설계 의의**<br>- 기존 GraphHopper 기능을 커스터마이징하여, 사용자 입력과 피드백 기반 경로 생성이 가능한 알고리즘을 자체 구현<br>- 출발지와 도착지가 같은 경우/다른 경우 모두 처리 가능한 이중 구조의 경로 탐색 방식으로 유연성 확보<br>- Firebase와 Spark Java 서버를 연계한 데이터 처리 구조와 MapLibre 기반 시각화를 통해 효율적이고 직관적인 사용자 경험 제공<br>- 피드백 기반 학습 기능을 통해 경로 개인화 및 지속적인 서비스 개선이 가능함 <br><img width="330" alt="Image" src="https://github.com/user-attachments/assets/e8a28341-a97a-42be-9502-be1fd26522ed" />[](url)<br>|
| (4) 주요 기능의 구현 | **🔹 기능 1: GraphHopper를 이용한 경로 생성 기능 구현**<br>- (1) Android 앱에서 사용자가 출발지/목적지 좌표, 원하는 거리 및 **경사도 선호도(높음/중간/낮음)**를 입력함<br>- (2) 입력된 값은 Firebase Firestore에 저장되며, 동시에 Firebase Cloud Functions를 통해 GraphHopper 서버에 HTTP 요청을 보냄<br>- (3) GraphHopper는 OpenStreetMap 데이터를 기반으로 조건을 만족하는 경로를 탐색하고, GeoJSON 형식의 경로 데이터를 반환<br>- (4) **경사도 계산을 위해**, OSM 보행자 도로 정보와 고도 정보를 포함한 **DEM(디지털 고도 모델)** 데이터를 QGIS에서 처리하여, **gpkg(GeoPackage)** 형식의 경사도 데이터를 사전 생성함<br>- (5) 해당 경사도 데이터는 경로 탐색 시 연동되어 사용자의 경사도 선호도를 반영한 경로 생성이 가능하도록 구현됨<br>- (6) 반환된 GeoJSON 파일은 Firebase Storage에 저장되며, 경로 식별자는 Firestore에 함께 기록됨<br><br>**🔹 기능 2: MapLibre를 이용한 경로 시각화 기능 구현**<br>- (1) Android 앱에서는 사용자가 탐색한 GeoJSON 경로를 Firebase Storage에서 다운로드<br>- (2) MapLibre SDK를 이용하여 해당 GeoJSON을 지도 위에 시각화<br>- (3) 지도에 표시된 경로는 출발지와 목적지에 핀을 표시하며, 경로 전체는 굵은 선(LineString)으로 표현<br>- **🔹 기능 3: 피드백 입력 및 경로 개선 반영**<br>- (1) 러닝이 종료되면 사용자는 해당 경로에 대해 만족도 또는 구간별 피드백을 앱에서 입력<br>- (2) 피드백은 Spark Java 서버를 통해 전달되어, 포맷 변환 및 예외 처리 후 Firebase Firestore에 저장됨<br>- (3) 각 피드백은 경로 ID와 연결되어 저장되며, 추후 분석을 위한 데이터로 사용됨<br>- (4) 일정 횟수 이상 동일 경로에 대한 부정적 피드백이 누적되면, Firebase Cloud Functions 또는 서버가 작동하여 해당 구간의 가중치를 감소시키도록 GraphHopper 추천 알고리즘에 반영함<br>- (5) 향후 동일 조건으로 경로 탐색 시 해당 구간이 포함될 가능성이 줄어들어 사용자 경험이 점진적으로 개선됨 | 해당 구간의 가중치를 감소시키도록 Routing 알고리즘에 반영함<br> |
| (5) 기타 | **🔹 기술적 도전 요소**<br>- GraphHopper를 서버에 배포하고 Android 앱과 통신하기 위해 Firebase Functions 또는 별도 REST API 구성이 필요함<br>- GeoJSON 데이터를 Android에서 실시간으로 불러오고 지도에 렌더링하는 과정에서 MapLibre SDK 활용 방식에 대한 학습 필요<br>- 경로 피드백을 기반으로 가중치를 학습하고 반영하는 알고리즘을 설계하고, 이 데이터를 어떻게 지속적으로 누적하고 반영할지에 대한 기준 마련이 필요함<br><br> **🔹 향후 계획**<br>- 2차 보고서 전까지 경로 생성 기능을 완성하고 Firebase와의 전체 흐름 연동을 마무리할 예정<br>- 피드백 입력 기능은 MVP 단계에서는 전체 경로 만족도 기준으로 제공하고, 이후 구간별 세부 피드백 입력 기능을 추가할 예정<br>- 완주 뱃지 시스템은 추후 조건별 자동 발급 및 시각적 뱃지함 구현 계획 있음 |

<br>


# 🔗 관련 링크

우리 팀이 수정 중인 오픈 소스 코드

https://github.com/jwayj/newNewGraphhopper
https://github.com/jwayj/RunPTApp

